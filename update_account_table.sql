BEGIN;

-- 1. 新增新欄位
ALTER TABLE "account" 
ADD COLUMN "parent_id" INTEGER,
ADD COLUMN "root_id" INTEGER,
ADD COLUMN "note" TEXT;

-- 2. 移除 code 的 unique 限制
ALTER TABLE "account" DROP CONSTRAINT IF EXISTS "account_code";

-- 3. 暫時禁用相關外鍵約束
ALTER TABLE "line_item" DROP CONSTRAINT IF EXISTS "line_item_account_id_fkey";
ALTER TABLE "account" DROP CONSTRAINT IF EXISTS "account_parent_code_fkey";
ALTER TABLE "account" DROP CONSTRAINT IF EXISTS "account_root_code_fkey";

-- 4. 更新預設會計科目的 ID 映射
CREATE TEMP TABLE account_id_mapping (
    old_id INTEGER,
    new_id INTEGER,
    code TEXT,
    parent_code TEXT,
    root_code TEXT
);

-- 插入映射關係
INSERT INTO account_id_mapping (old_id, code, new_id)
SELECT id, code, 
    CASE 
        WHEN code = '1XXX' THEN 1000
        WHEN code = '4000' THEN 1001
        WHEN code = '5000' THEN 1002
        WHEN code = '5850' THEN 1003
        WHEN code = '5860' THEN 1004
        WHEN code = '5900' THEN 1005
        WHEN code = '5910' THEN 1006
        WHEN code = '5920' THEN 1007
        WHEN code = '5950' THEN 1008
        WHEN code = '6000' THEN 1009
        WHEN code = '6500' THEN 1010
        WHEN code = '6900' THEN 1011
        WHEN code = '7000' THEN 1012
        WHEN code = '7900' THEN 1013
        WHEN code = '7950' THEN 1014
        WHEN code = '8000' THEN 1015
        WHEN code = '8100' THEN 1016
        WHEN code = '8160' THEN 1017
        WHEN code = '8200' THEN 1018
        WHEN code = '8300' THEN 1019
        WHEN code = '8400' THEN 1020
        WHEN code = '8500' THEN 1021
        WHEN code = '9750' THEN 1022
        WHEN code = '9850' THEN 1023
        WHEN code = 'AAAA0' THEN 1024
        WHEN code = 'AAAA1' THEN 1025
        WHEN code = 'AAAA' THEN 1026
        WHEN code = 'BBBB' THEN 1027
        WHEN code = 'CCCC' THEN 1028
        WHEN code = 'DDDD' THEN 1029
        WHEN code = 'EEEE' THEN 1030
        WHEN code = 'E00100' THEN 1031
        WHEN code = 'E00200' THEN 1032
        WHEN code = '2XXX' THEN 1033
        WHEN code = '3XXX' THEN 1034
        WHEN code = '3X2X' THEN 1035
        WHEN code = '3997' THEN 1036
        WHEN code = '11XX' THEN 1037
        WHEN code = '15XX' THEN 1038
        WHEN code = '4100' THEN 1039
        WHEN code = '4200' THEN 1040
        WHEN code = '4300' THEN 1041
        WHEN code = '4400' THEN 1042
        WHEN code = '4500' THEN 1043
        WHEN code = '4600' THEN 1044
        WHEN code = '4800' THEN 1045
        WHEN code = '5110' THEN 1046
        WHEN code = '5120' THEN 1047
        WHEN code = '5200' THEN 1048
        WHEN code = '5300' THEN 1049
        WHEN code = '5400' THEN 1050
        WHEN code = '5500' THEN 1051
        WHEN code = '5600' THEN 1052
        WHEN code = '5700' THEN 1053
        WHEN code = '5800' THEN 1054
        WHEN code = '6100' THEN 1055
        WHEN code = '6200' THEN 1056
        WHEN code = '6300' THEN 1057
        WHEN code = '6400' THEN 1058
        WHEN code = '6450' THEN 1059
        WHEN code = '6510' THEN 1060
        WHEN code = '6550' THEN 1061
        WHEN code = '7100' THEN 1062
        WHEN code = '7010' THEN 1063
        WHEN code = '7020' THEN 1064
        WHEN code = '7030' THEN 1065
        WHEN code = '7050' THEN 1066
        WHEN code = '7055' THEN 1067
        WHEN code = '7060' THEN 1068
        WHEN code = '7080' THEN 1069
        WHEN code = '7081' THEN 1070
        WHEN code = '7951' THEN 1071
        WHEN code = '7952' THEN 1072
        WHEN code = '8101' THEN 1073
        WHEN code = '8102' THEN 1074
        WHEN code = '8103' THEN 1075
        WHEN code = '8310' THEN 1076
        WHEN code = '8360' THEN 1077
        WHEN code = '9710' THEN 1078
        WHEN code = '9720' THEN 1079
        WHEN code = '9810' THEN 1080
        WHEN code = '9820' THEN 1081
        WHEN code = 'A00010' THEN 1082
        WHEN code = 'A00020' THEN 1083
        WHEN code = 'A10000' THEN 1084
        WHEN code = 'A20000' THEN 1085
        WHEN code = 'A33000' THEN 1086
        WHEN code = 'A33100' THEN 1087
        WHEN code = 'A33200' THEN 1088
        WHEN code = 'A33300' THEN 1089
        WHEN code = 'A33400' THEN 1090
        WHEN code = 'A33500' THEN 1091
        WHEN code = 'AA0000' THEN 1092
        WHEN code = 'AB0000' THEN 1093
        WHEN code = 'AC0100' THEN 1094
        WHEN code = 'AC0200' THEN 1095
        WHEN code = 'AC0300' THEN 1096
        WHEN code = 'AC0400' THEN 1097
        WHEN code = 'AC0500' THEN 1098
        WHEN code = 'AC0600' THEN 1099
        WHEN code = 'B00010' THEN 1100
        WHEN code = 'B00020' THEN 1101
        WHEN code = 'B00030' THEN 1102
        WHEN code = 'B00040' THEN 1103
        WHEN code = 'B00050' THEN 1104
        WHEN code = 'B00060' THEN 1105
        WHEN code = 'B00100' THEN 1106
        WHEN code = 'B00200' THEN 1107
        WHEN code = 'B01500' THEN 1108
        WHEN code = 'B01600' THEN 1109
        WHEN code = 'B01700' THEN 1110
        WHEN code = 'B01800' THEN 1111
        WHEN code = 'B01900' THEN 1112
        WHEN code = 'B02000' THEN 1113
        WHEN code = 'B02100' THEN 1114
        WHEN code = 'B02200' THEN 1115
        WHEN code = 'B02300' THEN 1116
        WHEN code = 'B02400' THEN 1117
        WHEN code = 'B02500' THEN 1118
        WHEN code = 'B02600' THEN 1119
        WHEN code = 'B02700' THEN 1120
        WHEN code = 'B02800' THEN 1121
        WHEN code = 'B02900' THEN 1122
        WHEN code = 'B03000' THEN 1123
        WHEN code = 'B03700' THEN 1124
        WHEN code = 'B03800' THEN 1125
        WHEN code = 'B04100' THEN 1126
        WHEN code = 'B04200' THEN 1127
        WHEN code = 'B04300' THEN 1128
        WHEN code = 'B04400' THEN 1129
        WHEN code = 'B04500' THEN 1130
        WHEN code = 'B04600' THEN 1131
        WHEN code = 'B04900' THEN 1132
        WHEN code = 'B05000' THEN 1133
        WHEN code = 'B05100' THEN 1134
        WHEN code = 'B05350' THEN 1135
        WHEN code = 'B05400' THEN 1136
        WHEN code = 'B05500' THEN 1137
        WHEN code = 'B05800' THEN 1138
        WHEN code = 'B05900' THEN 1139
        WHEN code = 'B06000' THEN 1140
        WHEN code = 'B06100' THEN 1141
        WHEN code = 'B06500' THEN 1142
        WHEN code = 'B06600' THEN 1143
        WHEN code = 'B06700' THEN 1144
        WHEN code = 'B06800' THEN 1145
        WHEN code = 'B07100' THEN 1146
        WHEN code = 'B07200' THEN 1147
        WHEN code = 'B07300' THEN 1148
        WHEN code = 'B07400' THEN 1149
        WHEN code = 'B07500' THEN 1150
        WHEN code = 'B07600' THEN 1151
        WHEN code = 'B07700' THEN 1152
        WHEN code = 'B09900' THEN 1153
        WHEN code = 'C00100' THEN 1154
        WHEN code = 'C00200' THEN 1155
        WHEN code = 'C00500' THEN 1156
        WHEN code = 'C00600' THEN 1157
        WHEN code = 'C00900' THEN 1158
        WHEN code = 'C01000' THEN 1159
        WHEN code = 'C01100' THEN 1160
        WHEN code = 'C01200' THEN 1161
        WHEN code = 'C01300' THEN 1162
        WHEN code = 'C01600' THEN 1163
        WHEN code = 'C01700' THEN 1164
        WHEN code = 'C01800' THEN 1165
        WHEN code = 'C01900' THEN 1166
        WHEN code = 'C02000' THEN 1167
        WHEN code = 'C02100' THEN 1168
        WHEN code = 'C02200' THEN 1169
        WHEN code = 'C02300' THEN 1170
        WHEN code = 'C02400' THEN 1171
        WHEN code = 'C02500' THEN 1172
        WHEN code = 'C02800' THEN 1173
        WHEN code = 'C02900' THEN 1174
        WHEN code = 'C03000' THEN 1175
        WHEN code = 'C03100' THEN 1176
        WHEN code = 'C03200' THEN 1177
        WHEN code = 'C03500' THEN 1178
        WHEN code = 'C03600' THEN 1179
        WHEN code = 'C03700' THEN 1180
        WHEN code = 'C03800' THEN 1181
        WHEN code = 'C03900' THEN 1182
        WHEN code = 'C04000' THEN 1183
        WHEN code = 'C04020' THEN 1184
        WHEN code = 'C04100' THEN 1185
        WHEN code = 'C04200' THEN 1186
        WHEN code = 'C04300' THEN 1187
        WHEN code = 'C04400' THEN 1188
        WHEN code = 'C04500' THEN 1189
        WHEN code = 'C04600' THEN 1190
        WHEN code = 'C04650' THEN 1191
        WHEN code = 'C04700' THEN 1192
        WHEN code = 'C04800' THEN 1193
        WHEN code = 'C04900' THEN 1194
        WHEN code = 'C04950' THEN 1195
        WHEN code = 'C05000' THEN 1196
        WHEN code = 'C05100' THEN 1197
        WHEN code = 'C05200' THEN 1198
        WHEN code = 'C05300' THEN 1199
        WHEN code = 'C05400' THEN 1200
        WHEN code = 'C05500' THEN 1201
        WHEN code = 'C05600' THEN 1202
        WHEN code = 'C05700' THEN 1203
        WHEN code = 'C09900' THEN 1204
        WHEN code = 'E00210' THEN 1205
        WHEN code = 'E00212' THEN 1206
        WHEN code = 'E00214' THEN 1207
        WHEN code = 'E00240' THEN 1208
        WHEN code = 'A1' THEN 1209
        WHEN code = 'A3' THEN 1210
        WHEN code = 'A4' THEN 1211
        WHEN code = 'A5' THEN 1212
        WHEN code = 'B0' THEN 1213
        WHEN code = 'C0' THEN 1214
        WHEN code = 'D1' THEN 1215
        WHEN code = 'D3' THEN 1216
        WHEN code = 'D5' THEN 1217
        WHEN code = 'E1' THEN 1218
        WHEN code = 'E2' THEN 1219
        WHEN code = 'E3' THEN 1220
        WHEN code = 'F1' THEN 1221
        WHEN code = 'F3' THEN 1222
        WHEN code = 'H1' THEN 1223
        WHEN code = 'H3' THEN 1224
        WHEN code = 'I1' THEN 1225
        WHEN code = 'I3' THEN 1226
        WHEN code = 'J1' THEN 1227
        WHEN code = 'J3' THEN 1228
        WHEN code = 'J5' THEN 1229
        WHEN code = 'K1' THEN 1230
        WHEN code = 'L1' THEN 1231
        WHEN code = 'L3' THEN 1232
        WHEN code = 'L4' THEN 1233
        WHEN code = 'L5' THEN 1234
        WHEN code = 'L7' THEN 1235
        WHEN code = 'M1' THEN 1236
        WHEN code = 'M3' THEN 1237
        WHEN code = 'M5' THEN 1238
        WHEN code = 'M7' THEN 1239
        WHEN code = 'N1' THEN 1240
        WHEN code = 'P1' THEN 1241
        WHEN code = 'Q1' THEN 1242
        WHEN code = 'T1' THEN 1243
        WHEN code = 'Y1' THEN 1244
        WHEN code = 'Z1' THEN 1245
        WHEN code = '21XX' THEN 1246
        WHEN code = '25XX' THEN 1247
        WHEN code = '3100' THEN 1248
        WHEN code = '3199' THEN 1249
        WHEN code = '3200' THEN 1250
        WHEN code = '3300' THEN 1251
        WHEN code = '3400' THEN 1252
        WHEN code = '3500' THEN 1253
        WHEN code = '35XX' THEN 1254
        WHEN code = '355X' THEN 1255
        WHEN code = '1100' THEN 1256
        WHEN code = '1110' THEN 1257
        WHEN code = '1120' THEN 1258
        WHEN code = '1136' THEN 1259
        WHEN code = '1139' THEN 1260
        WHEN code = '1140' THEN 1261
        WHEN code = '1150' THEN 1262
        WHEN code = '1160' THEN 1263
        WHEN code = '1170' THEN 1264
        WHEN code = '1180' THEN 1265
        WHEN code = '1190' THEN 1266
        WHEN code = '1195' THEN 1267
        WHEN code = '1196' THEN 1268
        WHEN code = '1197' THEN 1269
        WHEN code = '1198' THEN 1270
        WHEN code = '1199' THEN 1271
        WHEN code = '1200' THEN 1272
        WHEN code = '1210' THEN 1273
        WHEN code = '1220' THEN 1274
        WHEN code = '130X' THEN 1275
        WHEN code = '1400' THEN 1276
        WHEN code = '1410' THEN 1277
        WHEN code = '1450' THEN 1278
        WHEN code = '1460' THEN 1279
        WHEN code = '1470' THEN 1280
        WHEN code = '1510' THEN 1281
        WHEN code = '1517' THEN 1282
        WHEN code = '1535' THEN 1283
        WHEN code = '1538' THEN 1284
        WHEN code = '1560' THEN 1285
        WHEN code = '1550' THEN 1286
        WHEN code = '1600' THEN 1287
        WHEN code = '1750' THEN 1288
        WHEN code = '1755' THEN 1289
        WHEN code = '1760' THEN 1290
        WHEN code = '1780' THEN 1291
        WHEN code = '1830' THEN 1292
        WHEN code = '1840' THEN 1293
        WHEN code = '1900' THEN 1294
        WHEN code = '4110' THEN 1295
        WHEN code = '4120' THEN 1296
        WHEN code = '4130' THEN 1297
        WHEN code = '4170' THEN 1298
        WHEN code = '4190' THEN 1299
        WHEN code = '4210' THEN 1300
        WHEN code = '4220' THEN 1301
        WHEN code = '4230' THEN 1302
        WHEN code = '4240' THEN 1303
        WHEN code = '4250' THEN 1304
        WHEN code = '4260' THEN 1305
        WHEN code = '4310' THEN 1306
        WHEN code = '4330' THEN 1307
        WHEN code = '4410' THEN 1308
        WHEN code = '4420' THEN 1309
        WHEN code = '4510' THEN 1310
        WHEN code = '4520' THEN 1311
        WHEN code = '4610' THEN 1312
        WHEN code = '4620' THEN 1313
        WHEN code = '4630' THEN 1314
        WHEN code = '4640' THEN 1315
        WHEN code = '4650' THEN 1316
        WHEN code = '4660' THEN 1317
        WHEN code = '4670' THEN 1318
        WHEN code = '4680' THEN 1319
        WHEN code = '4881' THEN 1320
        WHEN code = '4889' THEN 1321
        WHEN code = '5111' THEN 1322
        WHEN code = '5112' THEN 1323
        WHEN code = '5260' THEN 1324
        WHEN code = '5310' THEN 1325
        WHEN code = '5330' THEN 1326
        WHEN code = '5340' THEN 1327
        WHEN code = '5410' THEN 1328
        WHEN code = '5420' THEN 1329
        WHEN code = '5510' THEN 1330
        WHEN code = '5520' THEN 1331
        WHEN code = '5610' THEN 1332
        WHEN code = '5620' THEN 1333
        WHEN code = '5630' THEN 1334
        WHEN code = '5640' THEN 1335
        WHEN code = '5650' THEN 1336
        WHEN code = '5660' THEN 1337
        WHEN code = '5670' THEN 1338
        WHEN code = '5680' THEN 1339
        WHEN code = '5710' THEN 1340
        WHEN code = '5720' THEN 1341
        WHEN code = '5730' THEN 1342
        WHEN code = '6110' THEN 1343
        WHEN code = '6111' THEN 1344
        WHEN code = '6112' THEN 1345
        WHEN code = '6113' THEN 1346
        WHEN code = '6114' THEN 1347
        WHEN code = '6115' THEN 1348
        WHEN code = '6116' THEN 1349
        WHEN code = '6117' THEN 1350
        WHEN code = '6118' THEN 1351
        WHEN code = '6119' THEN 1352
        WHEN code = '6120' THEN 1353
        WHEN code = '6121' THEN 1354
        WHEN code = '6122' THEN 1355
        WHEN code = '6124' THEN 1356
        WHEN code = '6125' THEN 1357
        WHEN code = '6127' THEN 1358
        WHEN code = '6128' THEN 1359
        WHEN code = '6130' THEN 1360
        WHEN code = '6131' THEN 1361
        WHEN code = '6132' THEN 1362
        WHEN code = '6151' THEN 1363
        WHEN code = '6153' THEN 1364
        WHEN code = '6188' THEN 1365
        WHEN code = '6210' THEN 1366
        WHEN code = '6211' THEN 1367
        WHEN code = '6212' THEN 1368
        WHEN code = '6213' THEN 1369
        WHEN code = '6214' THEN 1370
        WHEN code = '6215' THEN 1371
        WHEN code = '6216' THEN 1372
        WHEN code = '6217' THEN 1373
        WHEN code = '6218' THEN 1374
        WHEN code = '6219' THEN 1375
        WHEN code = '6220' THEN 1376
        WHEN code = '6221' THEN 1377
        WHEN code = '6222' THEN 1378
        WHEN code = '6224' THEN 1379
        WHEN code = '6225' THEN 1380
        WHEN code = '6227' THEN 1381
        WHEN code = '6228' THEN 1382
        WHEN code = '6229' THEN 1383
        WHEN code = '6231' THEN 1384
        WHEN code = '6232' THEN 1385
        WHEN code = '6233' THEN 1386
        WHEN code = '6288' THEN 1387
        WHEN code = '6310' THEN 1388
        WHEN code = '6311' THEN 1389
        WHEN code = '6312' THEN 1390
        WHEN code = '6313' THEN 1391
        WHEN code = '6314' THEN 1392
        WHEN code = '6315' THEN 1393
        WHEN code = '6316' THEN 1394
        WHEN code = '6318' THEN 1395
        WHEN code = '6319' THEN 1396
        WHEN code = '6320' THEN 1397
        WHEN code = '6321' THEN 1398
        WHEN code = '6322' THEN 1399
        WHEN code = '6324' THEN 1400
        WHEN code = '6325' THEN 1401
        WHEN code = '6327' THEN 1402
        WHEN code = '6328' THEN 1403
        WHEN code = '6329' THEN 1404
        WHEN code = '6331' THEN 1405
        WHEN code = '6388' THEN 1406
        WHEN code = '6511' THEN 1407
        WHEN code = '6512' THEN 1408
        WHEN code = '6513' THEN 1409
        WHEN code = '6514' THEN 1410
        WHEN code = '6520' THEN 1411
        WHEN code = '6551' THEN 1412
        WHEN code = '6552' THEN 1413
        WHEN code = '6553' THEN 1414
        WHEN code = '6554' THEN 1415
        WHEN code = '6560' THEN 1416
        WHEN code = '7101' THEN 1417
        WHEN code = '7102' THEN 1418
        WHEN code = '7105' THEN 1419
        WHEN code = '7106' THEN 1420
        WHEN code = '7107' THEN 1421
        WHEN code = '7110' THEN 1422
        WHEN code = '7120' THEN 1423
        WHEN code = '7130' THEN 1424
        WHEN code = '7140' THEN 1425
        WHEN code = '7150' THEN 1426
        WHEN code = '7160' THEN 1427
        WHEN code = '7170' THEN 1428
        WHEN code = '7175' THEN 1429
        WHEN code = '7180' THEN 1430
        WHEN code = '7190' THEN 1431
        WHEN code = '7210' THEN 1432
        WHEN code = '7215' THEN 1433
        WHEN code = '7220' THEN 1434
        WHEN code = '7225' THEN 1435
        WHEN code = '7226' THEN 1436
        WHEN code = '7227' THEN 1437
        WHEN code = '7228' THEN 1438
        WHEN code = '7229' THEN 1439
        WHEN code = '7230' THEN 1440
        WHEN code = '7235' THEN 1441
        WHEN code = '7240' THEN 1442
        WHEN code = '7245' THEN 1443
        WHEN code = '7250' THEN 1444
        WHEN code = '7255' THEN 1445
        WHEN code = '7260' THEN 1446
        WHEN code = '7265' THEN 1447
        WHEN code = '7270' THEN 1448
        WHEN code = '7530' THEN 1449
        WHEN code = '7540' THEN 1450
        WHEN code = '7550' THEN 1451
        WHEN code = '7560' THEN 1452
        WHEN code = '7580' THEN 1453
        WHEN code = '7590' THEN 1454
        WHEN code = '7610' THEN 1455
        WHEN code = '7615' THEN 1456
        WHEN code = '7620' THEN 1457
        WHEN code = '7625' THEN 1458
        WHEN code = '7626' THEN 1459
        WHEN code = '7627' THEN 1460
        WHEN code = '7628' THEN 1461
        WHEN code = '7630' THEN 1462
        WHEN code = '7635' THEN 1463
        WHEN code = '7640' THEN 1464
        WHEN code = '7645' THEN 1465
        WHEN code = '7650' THEN 1466
        WHEN code = '7655' THEN 1467
        WHEN code = '7660' THEN 1468
        WHEN code = '7665' THEN 1469
        WHEN code = '7670' THEN 1470
        WHEN code = '7350' THEN 1471
        WHEN code = '7750' THEN 1472
        WHEN code = '7299' THEN 1473
        WHEN code = '7300' THEN 1474
        WHEN code = '7510' THEN 1475
        WHEN code = '7520' THEN 1476
        WHEN code = '7700' THEN 1477
        WHEN code = '7380' THEN 1478
        WHEN code = '7880' THEN 1479
        WHEN code = '7370' THEN 1480
        WHEN code = '7770' THEN 1481
        WHEN code = '7360' THEN 1482
        WHEN code = '7760' THEN 1483
        WHEN code = '7361' THEN 1484
        WHEN code = '7761' THEN 1485
        WHEN code = '8311' THEN 1486
        WHEN code = '8312' THEN 1487
        WHEN code = '8313' THEN 1488
        WHEN code = '8314' THEN 1489
        WHEN code = '8315' THEN 1490
        WHEN code = '8316' THEN 1491
        WHEN code = '8317' THEN 1492
        WHEN code = '8320' THEN 1493
        WHEN code = '8341' THEN 1494
        WHEN code = '8349' THEN 1495
        WHEN code = '8361' THEN 1496
        WHEN code = '8365' THEN 1497
        WHEN code = '8366' THEN 1498
        WHEN code = '8367' THEN 1499
        WHEN code = '8368' THEN 1500
        WHEN code = '8370' THEN 1501
        WHEN code = '8391' THEN 1502
        WHEN code = '8399' THEN 1503
        WHEN code = 'A20010' THEN 1504
        WHEN code = 'A30000' THEN 1505
        WHEN code = 'AA0100' THEN 1506
        WHEN code = 'AA0200' THEN 1507
        WHEN code = 'AA0300' THEN 1508
        WHEN code = 'AA0400' THEN 1509
        WHEN code = 'AA0600' THEN 1510
        WHEN code = 'AA0700' THEN 1511
        WHEN code = 'AB0100' THEN 1512
        WHEN code = 'AB0200' THEN 1513
        WHEN code = 'AB0300' THEN 1514
        WHEN code = 'AB0400' THEN 1515
        WHEN code = 'AB0600' THEN 1516
        WHEN code = '4XXX' THEN 1517
        WHEN code = 'B1' THEN 1518
        WHEN code = 'B3' THEN 1519
        WHEN code = 'B5' THEN 1520
        WHEN code = 'B7' THEN 1521
        WHEN code = 'B8' THEN 1522
        WHEN code = 'B9' THEN 1523
        WHEN code = 'B11' THEN 1524
        WHEN code = 'B13' THEN 1525
        WHEN code = 'B15' THEN 1526
        WHEN code = 'B17' THEN 1527
        WHEN code = 'C1' THEN 1528
        WHEN code = 'C3' THEN 1529
        WHEN code = 'C5' THEN 1530
        WHEN code = 'C7' THEN 1531
        WHEN code = 'C11' THEN 1532
        WHEN code = 'C13' THEN 1533
        WHEN code = 'C15' THEN 1534
        WHEN code = 'C17' THEN 1535
        WHEN code = '2100' THEN 1536
        WHEN code = '2110' THEN 1537
        WHEN code = '2120' THEN 1538
        WHEN code = '2126' THEN 1539
        WHEN code = '2128' THEN 1540
        WHEN code = '2130' THEN 1541
        WHEN code = '2150' THEN 1542
        WHEN code = '2160' THEN 1543
        WHEN code = '2170' THEN 1544
        WHEN code = '2180' THEN 1545
        WHEN code = '2190' THEN 1546
        WHEN code = '2195' THEN 1547
        WHEN code = '2200' THEN 1548
        WHEN code = '2220' THEN 1549
        WHEN code = '2230' THEN 1550
        WHEN code = '2250' THEN 1551
        WHEN code = '2260' THEN 1552
        WHEN code = '2265' THEN 1553
        WHEN code = '2270' THEN 1554
        WHEN code = '2280' THEN 1555
        WHEN code = '2300' THEN 1556
        WHEN code = '2500' THEN 1557
        WHEN code = '2511' THEN 1558
        WHEN code = '2520' THEN 1559
        WHEN code = '2527' THEN 1560
        WHEN code = '2530' THEN 1561
        WHEN code = '2540' THEN 1562
        WHEN code = '2550' THEN 1563
        WHEN code = '2560' THEN 1564
        WHEN code = '2570' THEN 1565
        WHEN code = '2580' THEN 1566
        WHEN code = '2600' THEN 1567
        WHEN code = '3110' THEN 1568
        WHEN code = '3120' THEN 1569
        WHEN code = '3130' THEN 1570
        WHEN code = '3140' THEN 1571
        WHEN code = '3150' THEN 1572
        WHEN code = '3160' THEN 1573
        WHEN code = '3170' THEN 1574
        WHEN code = '3210' THEN 1575
        WHEN code = '3220' THEN 1576
        WHEN code = '3225' THEN 1577
        WHEN code = '3230' THEN 1578
        WHEN code = '3235' THEN 1579
        WHEN code = '3240' THEN 1580
        WHEN code = '3250' THEN 1581
        WHEN code = '3260' THEN 1582
        WHEN code = '3265' THEN 1583
        WHEN code = '3270' THEN 1584
        WHEN code = '3271' THEN 1585
        WHEN code = '3272' THEN 1586
        WHEN code = '3273' THEN 1587
        WHEN code = '3280' THEN 1588
        WHEN code = '3310' THEN 1589
        WHEN code = '3320' THEN 1590
        WHEN code = '3350' THEN 1591
        WHEN code = '3410' THEN 1592
        WHEN code = '3420' THEN 1593
        WHEN code = '3440' THEN 1594
        WHEN code = '3445' THEN 1595
        WHEN code = '3450' THEN 1596
        WHEN code = '3460' THEN 1597
        WHEN code = '3470' THEN 1598
        WHEN code = '3480' THEN 1599
        WHEN code = '3490' THEN 1600
        WHEN code = '1101' THEN 1601
        WHEN code = '1102' THEN 1602
        WHEN code = '1103' THEN 1603
        WHEN code = '1105' THEN 1604
        WHEN code = '1107' THEN 1605
        WHEN code = '1111' THEN 1606
        WHEN code = '1112' THEN 1607
        WHEN code = '1113' THEN 1608
        WHEN code = '1114' THEN 1609
        WHEN code = '1121' THEN 1610
        WHEN code = '1122' THEN 1611
        WHEN code = '1123' THEN 1612
        WHEN code = '1124' THEN 1613
        WHEN code = '1137' THEN 1614
        WHEN code = '1138' THEN 1615
        WHEN code = '1141' THEN 1616
        WHEN code = '1142' THEN 1617
        WHEN code = '1151' THEN 1618
        WHEN code = '1152' THEN 1619
        WHEN code = '1153' THEN 1620
        WHEN code = '1159' THEN 1621
        WHEN code = '1161' THEN 1622
        WHEN code = '1162' THEN 1623
        WHEN code = '1163' THEN 1624
        WHEN code = '1169' THEN 1625
        WHEN code = '1171' THEN 1626
        WHEN code = '1172' THEN 1627
        WHEN code = '1173' THEN 1628
        WHEN code = '1174' THEN 1629
        WHEN code = '1175' THEN 1630
        WHEN code = '1176' THEN 1631
        WHEN code = '1177' THEN 1632
        WHEN code = '1178' THEN 1633
        WHEN code = '1179' THEN 1634
        WHEN code = '1181' THEN 1635
        WHEN code = '1182' THEN 1636
        WHEN code = '1183' THEN 1637
        WHEN code = '1184' THEN 1638
        WHEN code = '1185' THEN 1639
        WHEN code = '1186' THEN 1640
        WHEN code = '1189' THEN 1641
        WHEN code = '119A' THEN 1642
        WHEN code = '119B' THEN 1643
        WHEN code = '119C' THEN 1644
        WHEN code = '119D' THEN 1645
        WHEN code = '119E' THEN 1646
        WHEN code = '119F' THEN 1647
        WHEN code = '119G' THEN 1648
        WHEN code = '119H' THEN 1649
        WHEN code = '119I' THEN 1650
        WHEN code = '119J' THEN 1651
        WHEN code = '1201' THEN 1652
        WHEN code = '1202' THEN 1653
        WHEN code = '1203' THEN 1654
        WHEN code = '1204' THEN 1655
        WHEN code = '1205' THEN 1656
        WHEN code = '1206' THEN 1657
        WHEN code = '1209' THEN 1658
        WHEN code = '1211' THEN 1659
        WHEN code = '1212' THEN 1660
        WHEN code = '1219' THEN 1661
        WHEN code = '1221' THEN 1662
        WHEN code = '1222' THEN 1663
        WHEN code = '1300' THEN 1664
        WHEN code = '1310' THEN 1665
        WHEN code = '1320' THEN 1666
        WHEN code = '1330' THEN 1667
        WHEN code = '1340' THEN 1668
        WHEN code = '1350' THEN 1669
        WHEN code = '1401' THEN 1670
        WHEN code = '1402' THEN 1671
        WHEN code = '1403' THEN 1672
        WHEN code = '1404' THEN 1673
        WHEN code = '1405' THEN 1674
        WHEN code = '1406' THEN 1675
        WHEN code = '1407' THEN 1676
        WHEN code = '1408' THEN 1677
        WHEN code = '1411' THEN 1678
        WHEN code = '1412' THEN 1679
        WHEN code = '1413' THEN 1680
        WHEN code = '1414' THEN 1681
        WHEN code = '1415' THEN 1682
        WHEN code = '1416' THEN 1683
        WHEN code = '1419' THEN 1684
        WHEN code = '1421' THEN 1685
        WHEN code = '1422' THEN 1686
        WHEN code = '1423' THEN 1687
        WHEN code = '1424' THEN 1688
        WHEN code = '1429' THEN 1689
        WHEN code = '1451' THEN 1690
        WHEN code = '1452' THEN 1691
        WHEN code = '1461' THEN 1692
        WHEN code = '1462' THEN 1693
        WHEN code = '1471' THEN 1694
        WHEN code = '1472' THEN 1695
        WHEN code = '1473' THEN 1696
        WHEN code = '1475' THEN 1697
        WHEN code = '1476' THEN 1698
        WHEN code = '1478' THEN 1699
        WHEN code = '1479' THEN 1700
        WHEN code = '1480' THEN 1701
        WHEN code = '1481' THEN 1702
        WHEN code = '1482' THEN 1703
        WHEN code = '1511' THEN 1704
        WHEN code = '1512' THEN 1705
        WHEN code = '1513' THEN 1706
        WHEN code = '1514' THEN 1707
        WHEN code = '1518' THEN 1708
        WHEN code = '1519' THEN 1709
        WHEN code = '1521' THEN 1710
        WHEN code = '1522' THEN 1711
        WHEN code = '1536' THEN 1712
        WHEN code = '1537' THEN 1713
        WHEN code = '1561' THEN 1714
        WHEN code = '1562' THEN 1715
        WHEN code = '1551' THEN 1716
        WHEN code = '1553' THEN 1717
        WHEN code = '1601' THEN 1718
        WHEN code = '1605' THEN 1719
        WHEN code = '1610' THEN 1720
        WHEN code = '1615' THEN 1721
        WHEN code = '1620' THEN 1722
        WHEN code = '1625' THEN 1723
        WHEN code = '1630' THEN 1724
        WHEN code = '1635' THEN 1725
        WHEN code = '1640' THEN 1726
        WHEN code = '1645' THEN 1727
        WHEN code = '1650' THEN 1728
        WHEN code = '1655' THEN 1729
        WHEN code = '1660' THEN 1730
        WHEN code = '1665' THEN 1731
        WHEN code = '1670' THEN 1732
        WHEN code = '1675' THEN 1733
        WHEN code = '1680' THEN 1734
        WHEN code = '1685' THEN 1735
        WHEN code = '1690' THEN 1736
        WHEN code = '1695' THEN 1737
        WHEN code = '1700' THEN 1738
        WHEN code = '1705' THEN 1739
        WHEN code = '1710' THEN 1740
        WHEN code = '1715' THEN 1741
        WHEN code = '1720' THEN 1742
        WHEN code = '1725' THEN 1743
        WHEN code = '1730' THEN 1744
        WHEN code = '1735' THEN 1745
        WHEN code = '1740' THEN 1746
        WHEN code = '1745' THEN 1747
        WHEN code = '1751' THEN 1748
        WHEN code = '1752' THEN 1749
        WHEN code = '1753' THEN 1750
        WHEN code = '1754' THEN 1751
        WHEN code = '175A' THEN 1752
        WHEN code = '175B' THEN 1753
        WHEN code = '175C' THEN 1754
        WHEN code = '175D' THEN 1755
        WHEN code = '175E' THEN 1756
        WHEN code = '175F' THEN 1757
        WHEN code = '175G' THEN 1758
        WHEN code = '176A' THEN 1759
        WHEN code = '176B' THEN 1760
        WHEN code = '176C' THEN 1761
        WHEN code = '176D' THEN 1762
        WHEN code = '176E' THEN 1763
        WHEN code = '1781' THEN 1764
        WHEN code = '1785' THEN 1765
        WHEN code = '1791' THEN 1766
        WHEN code = '1795' THEN 1767
        WHEN code = '1801' THEN 1768
        WHEN code = '1805' THEN 1769
        WHEN code = '1811' THEN 1770
        WHEN code = '1821' THEN 1771
        WHEN code = '1825' THEN 1772
        WHEN code = '1831' THEN 1773
        WHEN code = '1832' THEN 1774
        WHEN code = '1833' THEN 1775
        WHEN code = '1834' THEN 1776
        WHEN code = '1835' THEN 1777
        WHEN code = '1836' THEN 1778
        WHEN code = '1837' THEN 1779
        WHEN code = '1838' THEN 1780
        WHEN code = '1905' THEN 1781
        WHEN code = '1910' THEN 1782
        WHEN code = '1915' THEN 1783
        WHEN code = '1920' THEN 1784
        WHEN code = '1930' THEN 1785
        WHEN code = '1940' THEN 1786
        WHEN code = '194A' THEN 1787
        WHEN code = '194D' THEN 1788
        WHEN code = '194H' THEN 1789
        WHEN code = '194K' THEN 1790
        WHEN code = '1950' THEN 1791
        WHEN code = '1955' THEN 1792
        WHEN code = '1960' THEN 1793
        WHEN code = '1965' THEN 1794
        WHEN code = '1966' THEN 1795
        WHEN code = '1970' THEN 1796
        WHEN code = '1975' THEN 1797
        WHEN code = '1980' THEN 1798
        WHEN code = '1985' THEN 1799
        WHEN code = '1990' THEN 1800
        WHEN code = '4111' THEN 1801
        WHEN code = '4112' THEN 1802
        WHEN code = '4221' THEN 1803
        WHEN code = '4222' THEN 1804
        WHEN code = '4223' THEN 1805
        WHEN code = '4411' THEN 1806
        WHEN code = '4412' THEN 1807
        WHEN code = '4413' THEN 1808
        WHEN code = '4418' THEN 1809
        WHEN code = '4419' THEN 1810
        WHEN code = '4421' THEN 1811
        WHEN code = '4422' THEN 1812
        WHEN code = '4423' THEN 1813
        WHEN code = '4429' THEN 1814
        WHEN code = '4511' THEN 1815
        WHEN code = '4519' THEN 1816
        WHEN code = '4521' THEN 1817
        WHEN code = '4529' THEN 1818
        WHEN code = '4611' THEN 1819
        WHEN code = '4612' THEN 1820
        WHEN code = '4613' THEN 1821
        WHEN code = '4614' THEN 1822
        WHEN code = '4615' THEN 1823
        WHEN code = '4616' THEN 1824
        WHEN code = '4617' THEN 1825
        WHEN code = '4618' THEN 1826
        WHEN code = '4619' THEN 1827
        WHEN code = '4621' THEN 1828
        WHEN code = '4622' THEN 1829
        WHEN code = '4623' THEN 1830
        WHEN code = '4629' THEN 1831
        WHEN code = '4641' THEN 1832
        WHEN code = '4649' THEN 1833
        WHEN code = '4651' THEN 1834
        WHEN code = '4659' THEN 1835
        WHEN code = '4661' THEN 1836
        WHEN code = '4669' THEN 1837
        WHEN code = '4671' THEN 1838
        WHEN code = '4679' THEN 1839
        WHEN code = '4681' THEN 1840
        WHEN code = '4689' THEN 1841
        WHEN code = '5411' THEN 1842
        WHEN code = '5412' THEN 1843
        WHEN code = '5413' THEN 1844
        WHEN code = '5418' THEN 1845
        WHEN code = '5421' THEN 1846
        WHEN code = '5422' THEN 1847
        WHEN code = '5423' THEN 1848
        WHEN code = '5611' THEN 1849
        WHEN code = '5618' THEN 1850
        WHEN code = '5621' THEN 1851
        WHEN code = '5622' THEN 1852
        WHEN code = '5623' THEN 1853
        WHEN code = '5624' THEN 1854
        WHEN code = '5625' THEN 1855
        WHEN code = '5711' THEN 1856
        WHEN code = '5712' THEN 1857
        WHEN code = '5721' THEN 1858
        WHEN code = '5722' THEN 1859
        WHEN code = '5731' THEN 1860
        WHEN code = '5732' THEN 1861
        WHEN code = '5733' THEN 1862
        WHEN code = '7151' THEN 1863
        WHEN code = '7152' THEN 1864
        WHEN code = '7153' THEN 1865
        WHEN code = '7159' THEN 1866
        WHEN code = '7271' THEN 1867
        WHEN code = '7272' THEN 1868
        WHEN code = '7273' THEN 1869
        WHEN code = '7274' THEN 1870
        WHEN code = '7275' THEN 1871
        WHEN code = '727A' THEN 1872
        WHEN code = '7276' THEN 1873
        WHEN code = '7277' THEN 1874
        WHEN code = '7278' THEN 1875
        WHEN code = '7279' THEN 1876
        WHEN code = '7531' THEN 1877
        WHEN code = '7532' THEN 1878
        WHEN code = '7533' THEN 1879
        WHEN code = '7671' THEN 1880
        WHEN code = '7672' THEN 1881
        WHEN code = '7673' THEN 1882
        WHEN code = '767A' THEN 1883
        WHEN code = '7674' THEN 1884
        WHEN code = '7675' THEN 1885
        WHEN code = '7676' THEN 1886
        WHEN code = '7677' THEN 1887
        WHEN code = '7678' THEN 1888
        WHEN code = '7679' THEN 1889
        WHEN code = '730A' THEN 1890
        WHEN code = '730B' THEN 1891
        WHEN code = '730C' THEN 1892
        WHEN code = '730D' THEN 1893
        WHEN code = '730E' THEN 1894
        WHEN code = '730F' THEN 1895
        WHEN code = '770A' THEN 1896
        WHEN code = '770B' THEN 1897
        WHEN code = '770C' THEN 1898
        WHEN code = '770D' THEN 1899
        WHEN code = '770E' THEN 1900
        WHEN code = '770F' THEN 1901
        WHEN code = '831A' THEN 1902
        WHEN code = '831B' THEN 1903
        WHEN code = '831C' THEN 1904
        WHEN code = '831D' THEN 1905
        WHEN code = '8321' THEN 1906
        WHEN code = '8322' THEN 1907
        WHEN code = '8323' THEN 1908
        WHEN code = '8324' THEN 1909
        WHEN code = '8325' THEN 1910
        WHEN code = '8326' THEN 1911
        WHEN code = '8327' THEN 1912
        WHEN code = '836K' THEN 1913
        WHEN code = '836L' THEN 1914
        WHEN code = '836A' THEN 1915
        WHEN code = '836B' THEN 1916
        WHEN code = '836C' THEN 1917
        WHEN code = '836D' THEN 1918
        WHEN code = '836E' THEN 1919
        WHEN code = '836F' THEN 1920
        WHEN code = '836G' THEN 1921
        WHEN code = '836H' THEN 1922
        WHEN code = '836I' THEN 1923
        WHEN code = '836J' THEN 1924
        WHEN code = '8371' THEN 1925
        WHEN code = '8375' THEN 1926
        WHEN code = '8376' THEN 1927
        WHEN code = '8377' THEN 1928
        WHEN code = '8378' THEN 1929
        WHEN code = 'A20100' THEN 1930
        WHEN code = 'A20200' THEN 1931
        WHEN code = 'A20300' THEN 1932
        WHEN code = 'A20400' THEN 1933
        WHEN code = 'A20900' THEN 1934
        WHEN code = 'A21000' THEN 1935
        WHEN code = 'A21100' THEN 1936
        WHEN code = 'A21200' THEN 1937
        WHEN code = 'A21300' THEN 1938
        WHEN code = 'A21900' THEN 1939
        WHEN code = 'A22000' THEN 1940
        WHEN code = 'A22300' THEN 1941
        WHEN code = 'A22500' THEN 1942
        WHEN code = 'A22600' THEN 1943
        WHEN code = 'A22700' THEN 1944
        WHEN code = 'A22800' THEN 1945
        WHEN code = 'A22900' THEN 1946
        WHEN code = 'A23000' THEN 1947
        WHEN code = 'A23100' THEN 1948
        WHEN code = 'A23200' THEN 1949
        WHEN code = 'A23500' THEN 1950
        WHEN code = 'A23600' THEN 1951
        WHEN code = 'A23700' THEN 1952
        WHEN code = 'A23800' THEN 1953
        WHEN code = 'A23900' THEN 1954
        WHEN code = 'A24000' THEN 1955
        WHEN code = 'A24100' THEN 1956
        WHEN code = 'A24200' THEN 1957
        WHEN code = 'A24500' THEN 1958
        WHEN code = 'A24600' THEN 1959
        WHEN code = 'A29900' THEN 1960
        WHEN code = 'A31000' THEN 1961
        WHEN code = 'A32000' THEN 1962
        WHEN code = '2101' THEN 1963
        WHEN code = '2102' THEN 1964
        WHEN code = '2108' THEN 1965
        WHEN code = '2111' THEN 1966
        WHEN code = '2116' THEN 1967
        WHEN code = '2119' THEN 1968
        WHEN code = '2121' THEN 1969
        WHEN code = '2122' THEN 1970
        WHEN code = '2123' THEN 1971
        WHEN code = '2124' THEN 1972
        WHEN code = '2131' THEN 1973
        WHEN code = '2132' THEN 1974
        WHEN code = '2133' THEN 1975
        WHEN code = '2139' THEN 1976
        WHEN code = '2151' THEN 1977
        WHEN code = '2152' THEN 1978
        WHEN code = '2161' THEN 1979
        WHEN code = '2162' THEN 1980
        WHEN code = '2171' THEN 1981
        WHEN code = '2172' THEN 1982
        WHEN code = '2181' THEN 1983
        WHEN code = '2182' THEN 1984
        WHEN code = '2201' THEN 1985
        WHEN code = '2202' THEN 1986
        WHEN code = '2203' THEN 1987
        WHEN code = '2204' THEN 1988
        WHEN code = '2205' THEN 1989
        WHEN code = '2206' THEN 1990
        WHEN code = '2207' THEN 1991
        WHEN code = '2209' THEN 1992
        WHEN code = '2211' THEN 1993
        WHEN code = '2212' THEN 1994
        WHEN code = '2213' THEN 1995
        WHEN code = '2214' THEN 1996
        WHEN code = '2215' THEN 1997
        WHEN code = '2216' THEN 1998
        WHEN code = '2219' THEN 1999
        WHEN code = '2251' THEN 2000
        WHEN code = '2252' THEN 2001
        WHEN code = '2253' THEN 2002
        WHEN code = '2254' THEN 2003
        WHEN code = '2255' THEN 2004
        WHEN code = '2256' THEN 2005
        WHEN code = '2257' THEN 2006
        WHEN code = '2259' THEN 2007
        WHEN code = '2281' THEN 2008
        WHEN code = '2282' THEN 2009
        WHEN code = '2305' THEN 2010
        WHEN code = '2310' THEN 2011
        WHEN code = '2320' THEN 2012
        WHEN code = '2325' THEN 2013
        WHEN code = '2330' THEN 2014
        WHEN code = '2335' THEN 2015
        WHEN code = '2350' THEN 2016
        WHEN code = '2355' THEN 2017
        WHEN code = '2360' THEN 2018
        WHEN code = '2365' THEN 2019
        WHEN code = '2370' THEN 2020
        WHEN code = '2399' THEN 2021
        WHEN code = '2501' THEN 2022
        WHEN code = '2502' THEN 2023
        WHEN code = '2503' THEN 2024
        WHEN code = '2504' THEN 2025
        WHEN code = '2531' THEN 2026
        WHEN code = '2532' THEN 2027
        WHEN code = '2541' THEN 2028
        WHEN code = '2542' THEN 2029
        WHEN code = '2543' THEN 2030
        WHEN code = '2551' THEN 2031
        WHEN code = '2552' THEN 2032
        WHEN code = '2553' THEN 2033
        WHEN code = '2554' THEN 2034
        WHEN code = '2555' THEN 2035
        WHEN code = '2556' THEN 2036
        WHEN code = '2559' THEN 2037
        WHEN code = '2571' THEN 2038
        WHEN code = '2572' THEN 2039
        WHEN code = '2573' THEN 2040
        WHEN code = '2581' THEN 2041
        WHEN code = '2582' THEN 2042
        WHEN code = '2610' THEN 2043
        WHEN code = '2620' THEN 2044
        WHEN code = '2630' THEN 2045
        WHEN code = '2635' THEN 2046
        WHEN code = '2640' THEN 2047
        WHEN code = '2645' THEN 2048
        WHEN code = '2650' THEN 2049
        WHEN code = '2655' THEN 2050
        WHEN code = '2665' THEN 2051
        WHEN code = '2670' THEN 2052
        WHEN code = '2675' THEN 2053
        WHEN code = '2680' THEN 2054
        WHEN code = '2690' THEN 2055
        WHEN code = '3211' THEN 2056
        WHEN code = '3212' THEN 2057
        WHEN code = '3213' THEN 2058
        WHEN code = '3251' THEN 2059
        WHEN code = '3252' THEN 2060
        WHEN code = '3351' THEN 2061
        WHEN code = '3352' THEN 2062
        WHEN code = '3353' THEN 2063
        WHEN code = '3411' THEN 2064
        WHEN code = '341A' THEN 2065
        WHEN code = '3412' THEN 2066
        WHEN code = '341B' THEN 2067
        WHEN code = '3413' THEN 2068
        WHEN code = '341C' THEN 2069
        WHEN code = '3421' THEN 2070
        WHEN code = '3422' THEN 2071
        WHEN code = '3423' THEN 2072
        WHEN code = '3424' THEN 2073
        WHEN code = '342A' THEN 2074
        WHEN code = '342B' THEN 2075
        WHEN code = '342C' THEN 2076
        WHEN code = '342D' THEN 2077
        WHEN code = '342E' THEN 2078
        WHEN code = '3441' THEN 2079
        WHEN code = '3442' THEN 2080
        WHEN code = '3443' THEN 2081
        WHEN code = '3446' THEN 2082
        WHEN code = '3447' THEN 2083
        WHEN code = '3448' THEN 2084
        WHEN code = '3451' THEN 2085
        WHEN code = '3452' THEN 2086
        WHEN code = '3453' THEN 2087
        WHEN code = '3461' THEN 2088
        WHEN code = '3462' THEN 2089
        WHEN code = '3463' THEN 2090
        WHEN code = '3471' THEN 2091
        WHEN code = '3472' THEN 2092
        WHEN code = '3473' THEN 2093
        WHEN code = '3481' THEN 2094
        WHEN code = '3482' THEN 2095
        WHEN code = '3483' THEN 2096
        WHEN code = '3491' THEN 2097
        WHEN code = '3499' THEN 2098
        WHEN code = '1301' THEN 2099
        WHEN code = '1302' THEN 2100
        WHEN code = '1308' THEN 2101
        WHEN code = '1309' THEN 2102
        WHEN code = '1311' THEN 2103
        WHEN code = '1312' THEN 2104
        WHEN code = '1313' THEN 2105
        WHEN code = '1314' THEN 2106
        WHEN code = '1315' THEN 2107
        WHEN code = '1316' THEN 2108
        WHEN code = '1318' THEN 2109
        WHEN code = '1319' THEN 2110
        WHEN code = '1321' THEN 2111
        WHEN code = '1322' THEN 2112
        WHEN code = '1323' THEN 2113
        WHEN code = '1324' THEN 2114
        WHEN code = '1325' THEN 2115
        WHEN code = '1326' THEN 2116
        WHEN code = '1328' THEN 2117
        WHEN code = '1329' THEN 2118
        WHEN code = '1331' THEN 2119
        WHEN code = '1332' THEN 2120
        WHEN code = '1333' THEN 2121
        WHEN code = '1338' THEN 2122
        WHEN code = '1339' THEN 2123
        WHEN code = '1351' THEN 2124
        WHEN code = '1352' THEN 2125
        WHEN code = '1353' THEN 2126
        WHEN code = '1354' THEN 2127
        WHEN code = '1355' THEN 2128
        WHEN code = '1356' THEN 2129
        WHEN code = '1357' THEN 2130
        WHEN code = '148A' THEN 2131
        WHEN code = '148B' THEN 2132
        WHEN code = '148C' THEN 2133
        WHEN code = '148D' THEN 2134
        WHEN code = '1602' THEN 2135
        WHEN code = '1603' THEN 2136
        WHEN code = '1604' THEN 2137
        WHEN code = '1606' THEN 2138
        WHEN code = '1607' THEN 2139
        WHEN code = '1608' THEN 2140
        WHEN code = '1609' THEN 2141
        WHEN code = '1611' THEN 2142
        WHEN code = '1612' THEN 2143
        WHEN code = '1613' THEN 2144
        WHEN code = '1614' THEN 2145
        WHEN code = '1616' THEN 2146
        WHEN code = '1617' THEN 2147
        WHEN code = '1618' THEN 2148
        WHEN code = '1619' THEN 2149
        WHEN code = '1621' THEN 2150
        WHEN code = '1622' THEN 2151
        WHEN code = '1623' THEN 2152
        WHEN code = '1624' THEN 2153
        WHEN code = '1626' THEN 2154
        WHEN code = '1627' THEN 2155
        WHEN code = '1628' THEN 2156
        WHEN code = '1629' THEN 2157
        WHEN code = '1631' THEN 2158
        WHEN code = '1632' THEN 2159
        WHEN code = '1633' THEN 2160
        WHEN code = '1634' THEN 2161
        WHEN code = '1636' THEN 2162
        WHEN code = '1637' THEN 2163
        WHEN code = '1638' THEN 2164
        WHEN code = '1639' THEN 2165
        WHEN code = '1641' THEN 2166
        WHEN code = '1642' THEN 2167
        WHEN code = '1643' THEN 2168
        WHEN code = '1644' THEN 2169
        WHEN code = '1646' THEN 2170
        WHEN code = '1647' THEN 2171
        WHEN code = '1648' THEN 2172
        WHEN code = '1649' THEN 2173
        WHEN code = '1651' THEN 2174
        WHEN code = '1652' THEN 2175
        WHEN code = '1653' THEN 2176
        WHEN code = '1654' THEN 2177
        WHEN code = '1656' THEN 2178
        WHEN code = '1657' THEN 2179
        WHEN code = '1658' THEN 2180
        WHEN code = '1659' THEN 2181
        WHEN code = '1661' THEN 2182
        WHEN code = '1662' THEN 2183
        WHEN code = '1663' THEN 2184
        WHEN code = '1664' THEN 2185
        WHEN code = '1666' THEN 2186
        WHEN code = '1667' THEN 2187
        WHEN code = '1668' THEN 2188
        WHEN code = '1669' THEN 2189
        WHEN code = '1671' THEN 2190
        WHEN code = '1672' THEN 2191
        WHEN code = '1673' THEN 2192
        WHEN code = '1674' THEN 2193
        WHEN code = '1676' THEN 2194
        WHEN code = '1677' THEN 2195
        WHEN code = '1678' THEN 2196
        WHEN code = '1679' THEN 2197
        WHEN code = '1681' THEN 2198
        WHEN code = '1682' THEN 2199
        WHEN code = '1683' THEN 2200
        WHEN code = '1684' THEN 2201
        WHEN code = '1686' THEN 2202
        WHEN code = '1687' THEN 2203
        WHEN code = '1688' THEN 2204
        WHEN code = '1689' THEN 2205
        WHEN code = '1691' THEN 2206
        WHEN code = '1692' THEN 2207
        WHEN code = '1693' THEN 2208
        WHEN code = '1694' THEN 2209
        WHEN code = '1696' THEN 2210
        WHEN code = '1697' THEN 2211
        WHEN code = '1698' THEN 2212
        WHEN code = '1699' THEN 2213
        WHEN code = '1701' THEN 2214
        WHEN code = '1702' THEN 2215
        WHEN code = '1703' THEN 2216
        WHEN code = '1704' THEN 2217
        WHEN code = '1706' THEN 2218
        WHEN code = '1707' THEN 2219
        WHEN code = '1708' THEN 2220
        WHEN code = '1709' THEN 2221
        WHEN code = '1711' THEN 2222
        WHEN code = '1712' THEN 2223
        WHEN code = '1713' THEN 2224
        WHEN code = '1714' THEN 2225
        WHEN code = '1716' THEN 2226
        WHEN code = '1717' THEN 2227
        WHEN code = '1718' THEN 2228
        WHEN code = '1719' THEN 2229
        WHEN code = '1721' THEN 2230
        WHEN code = '1722' THEN 2231
        WHEN code = '1723' THEN 2232
        WHEN code = '1724' THEN 2233
        WHEN code = '1726' THEN 2234
        WHEN code = '1727' THEN 2235
        WHEN code = '1728' THEN 2236
        WHEN code = '1729' THEN 2237
        WHEN code = '1731' THEN 2238
        WHEN code = '1732' THEN 2239
        WHEN code = '1733' THEN 2240
        WHEN code = '1734' THEN 2241
        WHEN code = '1736' THEN 2242
        WHEN code = '1737' THEN 2243
        WHEN code = '1738' THEN 2244
        WHEN code = '1739' THEN 2245
        WHEN code = '1746' THEN 2246
        WHEN code = '1747' THEN 2247
        WHEN code = '1748' THEN 2248
        WHEN code = '1749' THEN 2249
        WHEN code = '17AA' THEN 2250
        WHEN code = '17AB' THEN 2251
        WHEN code = '17AC' THEN 2252
        WHEN code = '17AD' THEN 2253
        WHEN code = '17AE' THEN 2254
        WHEN code = '17BA' THEN 2255
        WHEN code = '17BB' THEN 2256
        WHEN code = '17BC' THEN 2257
        WHEN code = '17BD' THEN 2258
        WHEN code = '17BE' THEN 2259
        WHEN code = '17CA' THEN 2260
        WHEN code = '17CB' THEN 2261
        WHEN code = '17CC' THEN 2262
        WHEN code = '17CD' THEN 2263
        WHEN code = '17CE' THEN 2264
        WHEN code = '17DA' THEN 2265
        WHEN code = '17DB' THEN 2266
        WHEN code = '17DC' THEN 2267
        WHEN code = '17DD' THEN 2268
        WHEN code = '17DE' THEN 2269
        WHEN code = '17EA' THEN 2270
        WHEN code = '17EB' THEN 2271
        WHEN code = '17EC' THEN 2272
        WHEN code = '17ED' THEN 2273
        WHEN code = '17EE' THEN 2274
        WHEN code = '17FA' THEN 2275
        WHEN code = '17FB' THEN 2276
        WHEN code = '17FC' THEN 2277
        WHEN code = '17FD' THEN 2278
        WHEN code = '17FE' THEN 2279
        WHEN code = '17GA' THEN 2280
        WHEN code = '17GB' THEN 2281
        WHEN code = '17GC' THEN 2282
        WHEN code = '17GD' THEN 2283
        WHEN code = '17GE' THEN 2284
        WHEN code = '1761' THEN 2285
        WHEN code = '1762' THEN 2286
        WHEN code = '1763' THEN 2287
        WHEN code = '1764' THEN 2288
        WHEN code = '1765' THEN 2289
        WHEN code = '1766' THEN 2290
        WHEN code = '1767' THEN 2291
        WHEN code = '1768' THEN 2292
        WHEN code = '1769' THEN 2293
        WHEN code = '1771' THEN 2294
        WHEN code = '1772' THEN 2295
        WHEN code = '1776' THEN 2296
        WHEN code = '1777' THEN 2297
        WHEN code = '1778' THEN 2298
        WHEN code = '1779' THEN 2299
        WHEN code = '1773' THEN 2300
        WHEN code = '1774' THEN 2301
        WHEN code = '1775' THEN 2302
        WHEN code = '1782' THEN 2303
        WHEN code = '1783' THEN 2304
        WHEN code = '1784' THEN 2305
        WHEN code = '1786' THEN 2306
        WHEN code = '1787' THEN 2307
        WHEN code = '1788' THEN 2308
        WHEN code = '1792' THEN 2309
        WHEN code = '1793' THEN 2310
        WHEN code = '1794' THEN 2311
        WHEN code = '1796' THEN 2312
        WHEN code = '1797' THEN 2313
        WHEN code = '1798' THEN 2314
        WHEN code = '1802' THEN 2315
        WHEN code = '1803' THEN 2316
        WHEN code = '1804' THEN 2317
        WHEN code = '1812' THEN 2318
        WHEN code = '1813' THEN 2319
        WHEN code = '1814' THEN 2320
        WHEN code = '1822' THEN 2321
        WHEN code = '1823' THEN 2322
        WHEN code = '1824' THEN 2323
        WHEN code = '1826' THEN 2324
        WHEN code = '1827' THEN 2325
        WHEN code = '1906' THEN 2326
        WHEN code = '1907' THEN 2327
        WHEN code = '1908' THEN 2328
        WHEN code = '1909' THEN 2329
        WHEN code = '1911' THEN 2330
        WHEN code = '1912' THEN 2331
        WHEN code = '1914' THEN 2332
        WHEN code = '1931' THEN 2333
        WHEN code = '1932' THEN 2334
        WHEN code = '1933' THEN 2335
        WHEN code = '1934' THEN 2336
        WHEN code = '1935' THEN 2337
        WHEN code = '1936' THEN 2338
        WHEN code = '1937' THEN 2339
        WHEN code = '1939' THEN 2340
        WHEN code = '1941' THEN 2341
        WHEN code = '1942' THEN 2342
        WHEN code = '1943' THEN 2343
        WHEN code = '1944' THEN 2344
        WHEN code = '1945' THEN 2345
        WHEN code = '1946' THEN 2346
        WHEN code = '1947' THEN 2347
        WHEN code = '1949' THEN 2348
        WHEN code = '194B' THEN 2349
        WHEN code = '194C' THEN 2350
        WHEN code = '194E' THEN 2351
        WHEN code = '194F' THEN 2352
        WHEN code = '194G' THEN 2353
        WHEN code = '194I' THEN 2354
        WHEN code = '194J' THEN 2355
        WHEN code = '194L' THEN 2356
        WHEN code = '194M' THEN 2357
        WHEN code = '194N' THEN 2358
        WHEN code = '1951' THEN 2359
        WHEN code = '1952' THEN 2360
        WHEN code = '1953' THEN 2361
        WHEN code = '1956' THEN 2362
        WHEN code = '1957' THEN 2363
        WHEN code = '1967' THEN 2364
        WHEN code = '1968' THEN 2365
        WHEN code = '1971' THEN 2366
        WHEN code = '1972' THEN 2367
        WHEN code = '1981' THEN 2368
        WHEN code = '1984' THEN 2369
        WHEN code = '1992' THEN 2370
        WHEN code = '1993' THEN 2371
        WHEN code = '1995' THEN 2372
        WHEN code = '1996' THEN 2373
        WHEN code = '832A' THEN 2374
        WHEN code = '832B' THEN 2375
        WHEN code = '832C' THEN 2376
        WHEN code = '832D' THEN 2377
        WHEN code = '837K' THEN 2378
        WHEN code = '837L' THEN 2379
        WHEN code = '837A' THEN 2380
        WHEN code = '837B' THEN 2381
        WHEN code = '837C' THEN 2382
        WHEN code = '837D' THEN 2383
        WHEN code = '837E' THEN 2384
        WHEN code = '837F' THEN 2385
        WHEN code = '837G' THEN 2386
        WHEN code = '837H' THEN 2387
        WHEN code = '837I' THEN 2388
        WHEN code = '837J' THEN 2389
        WHEN code = 'A31115' THEN 2390
        WHEN code = 'A31120' THEN 2391
        WHEN code = 'A31125' THEN 2392
        WHEN code = 'A31130' THEN 2393
        WHEN code = 'A31140' THEN 2394
        WHEN code = 'A31150' THEN 2395
        WHEN code = 'A31160' THEN 2396
        WHEN code = 'A31180' THEN 2397
        WHEN code = 'A31190' THEN 2398
        WHEN code = 'A31200' THEN 2399
        WHEN code = 'A31210' THEN 2400
        WHEN code = 'A31220' THEN 2401
        WHEN code = 'A31230' THEN 2402
        WHEN code = 'A31240' THEN 2403
        WHEN code = 'A31250' THEN 2404
        WHEN code = 'A31260' THEN 2405
        WHEN code = 'A31270' THEN 2406
        WHEN code = 'A31280' THEN 2407
        WHEN code = 'A31990' THEN 2408
        WHEN code = 'A32110' THEN 2409
        WHEN code = 'A32120' THEN 2410
        WHEN code = 'A32125' THEN 2411
        WHEN code = 'A32130' THEN 2412
        WHEN code = 'A32140' THEN 2413
        WHEN code = 'A32150' THEN 2414
        WHEN code = 'A32160' THEN 2415
        WHEN code = 'A32180' THEN 2416
        WHEN code = 'A32190' THEN 2417
        WHEN code = 'A32200' THEN 2418
        WHEN code = 'A32210' THEN 2419
        WHEN code = 'A32220' THEN 2420
        WHEN code = 'A32230' THEN 2421
        WHEN code = 'A32240' THEN 2422
        WHEN code = 'A32250' THEN 2423
        WHEN code = 'A32990' THEN 2424
        WHEN code = '3190' THEN 2425
        WHEN code = '3425' THEN 2426
        WHEN code = '3430' THEN 2427
        WHEN code = '3435' THEN 2428
        WHEN code = '3485' THEN 2429
        WHEN code = '2313' THEN 2430
        WHEN code = '2314' THEN 2431
        WHEN code = '2315' THEN 2432
        WHEN code = '2321' THEN 2433
        WHEN code = '2322' THEN 2434
        WHEN code = '2323' THEN 2435
        WHEN code = '2324' THEN 2436
        WHEN code = '2611' THEN 2437
        WHEN code = '2612' THEN 2438
        WHEN code = '2613' THEN 2439
        WHEN code = '2614' THEN 2440
        WHEN code = '2621' THEN 2441
        WHEN code = '2622' THEN 2442
        WHEN code = '2623' THEN 2443
        WHEN code = '2624' THEN 2444
        WHEN code = '345A' THEN 2445
        WHEN code = '345B' THEN 2446
        WHEN code = '345C' THEN 2447
        WHEN code = '345D' THEN 2448
        WHEN code = '345E' THEN 2449
        WHEN code = '345F' THEN 2450
        WHEN code = '345G' THEN 2451
        WHEN code = '345H' THEN 2452
        WHEN code = '345I' THEN 2453
        WHEN code = '345J' THEN 2454
        WHEN code = '345K' THEN 2455
        WHEN code = '345L' THEN 2456
        WHEN code = '345M' THEN 2457
        WHEN code = '345N' THEN 2458
        WHEN code = '345O' THEN 2459
        WHEN code = '345P' THEN 2460
        WHEN code = '345Q' THEN 2461
        WHEN code = '345R' THEN 2462
        WHEN code = '345S' THEN 2463
        WHEN code = '345T' THEN 2464
        WHEN code = '345U' THEN 2465
        WHEN code = '345V' THEN 2466
        WHEN code = '345W' THEN 2467
        WHEN code = '345X' THEN 2468
        ELSE id  -- 對於未指定的保持原樣
    END
FROM account;

-- 5. 更新 parent_id 和 root_id
UPDATE account a
SET parent_id = (
    SELECT m2.new_id 
    FROM account_id_mapping m2 
    JOIN account a2 ON a2.code = a.parent_code 
    WHERE m2.code = a2.code
),
root_id = (
    SELECT m3.new_id 
    FROM account_id_mapping m3 
    JOIN account a3 ON a3.code = a.root_code 
    WHERE m3.code = a3.code
);

-- 6. 更新自訂會計科目的 parent_id 和 root_id
UPDATE account a
SET parent_id = (
    SELECT id FROM account WHERE code = a.parent_code
),
root_id = (
    SELECT id FROM account WHERE code = a.root_code
)
WHERE a.id NOT IN (SELECT new_id FROM account_id_mapping);

-- -- 7. 移除舊的外鍵關係欄位
-- ALTER TABLE "account" DROP COLUMN "parent_code";
-- ALTER TABLE "account" DROP COLUMN "root_code";

-- 8. 建立新的外鍵約束
ALTER TABLE "account" 
ADD CONSTRAINT "account_parent_id_fkey" 
FOREIGN KEY ("parent_id") 
REFERENCES "account"("id") 
ON DELETE RESTRICT ON UPDATE CASCADE;

ALTER TABLE "account" 
ADD CONSTRAINT "account_root_id_fkey" 
FOREIGN KEY ("root_id") 
REFERENCES "account"("id") 
ON DELETE RESTRICT ON UPDATE CASCADE;

-- 9. 重新建立 line_item 的外鍵約束
ALTER TABLE "line_item" 
ADD CONSTRAINT "line_item_account_id_fkey" 
FOREIGN KEY ("account_id") 
REFERENCES "account"("id") 
ON DELETE RESTRICT ON UPDATE CASCADE;

-- 10. 清理臨時表
DROP TABLE account_id_mapping;

COMMIT;
